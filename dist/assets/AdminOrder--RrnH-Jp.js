import{M as k,T as L}from"./bootstrap.esm-l9cKv-78.js";import{p as M}from"./PaginationMode--Btpn8b-.js";import{_ as T,c as a,b as v,w as E,d as t,F as _,z as m,t as o,A as u,B as w,G as x,r as I,o as n}from"./index-MOHmFcjI.js";import{_ as V}from"./icon-t1Ce2sCx.js";var D={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"peggy123",VITE_TEXT:"這是部署的環境",BASE_URL:"/Raiko/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:b,VITE_PATH:g}=D;let y=null,f=null,h=null;const B={data(){return{orders:[],totalPage:"",currentPage:1,perpage:10,tempItem:{},toastTitle:"",toastContent:"",isLoading:!0,fallPage:!1}},components:{pagination:M},methods:{getData(d=1){const l=`${b}/api/${g}/admin/orders?page=${d}`;this.isLoading=!0,this.$http.get(l).then(c=>{this.orders=c.data.orders,this.totalPage=c.data.pagination.total_pages}).catch(c=>{this.toastTitle="取得訂單",this.toastContent=c.response.data.message,h.show()}).finally(()=>{this.isLoading=!1})},updatePaid(d){const l=`${b}/api/${g}/admin/order/${d.id}`,c={is_paid:d.is_paid};this.isLoading=!0,this.$http.put(l,{data:c}).then(p=>{console.log(p),y.hide(),this.toastTitle="更新付款狀態",this.toastContent="訂單狀態已更新成功",h.show()}).catch(p=>{this.toastContent=p.response.data.message,h.show()}).finally(()=>{this.isLoading=!1})},openModal(d,l){this.tempItem=d,l==="edit"?y.show():l==="delete"&&f.show()},deleteOrder(){const d=`${b}/api/${g}/admin/order/${this.tempItem.id}`;this.isLoading=!0,this.$http.delete(d).then(()=>{f.hide(),this.getData(),this.toastTitle="更新訂單",this.toastContent="訂單已成功刪除",h.show()}).catch(l=>{this.toastContent=l.response.data.message,h.show()}).finally(()=>{this.isLoading=!1})},swichPage(d){this.currentPage=d}},computed:{totalPage(){return Math.ceil(this.orders.length/this.perpage)}},mounted(){const d=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=d,y=new k(document.getElementById("orderModal"),{keyboard:!1}),f=new k(document.getElementById("deleteModal"),{keyboard:!1}),h=new L(document.getElementById("toast")),this.getData()}},S=t("div",{class:"loading-img-bg"},[t("img",{class:"loading-img",src:V,alt:""})],-1),U={class:"container"},A=t("h2",{class:"py-8 mb-0"},"訂單管理",-1),O={class:"row"},R={class:"table align-middle text-center table-striped"},N=t("thead",null,[t("tr",{class:"table-dark"},[t("th",{scope:"col"},"購買時間"),t("th",{scope:"col",width:"250"},"Email"),t("th",{scope:"col",width:"250"},"購買品項"),t("th",{scope:"col"},"應付金額"),t("th",{scope:"col"},"付款狀態"),t("th",{scope:"col"}),t("th",{scope:"col"})])],-1),j={key:0},q={scope:"row"},z={key:"product.id",class:"ps-0 mb-0 list-unstyled"},F={class:"mb-2 d-flex"},H=["src"],G={class:"d-flex align-items-center justify-content-between flex-grow-1"},X={class:"text-dark text-start"},J={class:"form-check form-switch"},K=["onUpdate:modelValue","onChange"],Q={class:"form-check-label"},W={key:0,class:"text-success fw-bold"},Y={key:1,class:"text-secondary"},Z=["onClick"],$=t("i",{class:"bi bi-eye-fill me-2"},null,-1),tt=t("span",null,"檢視",-1),et=[$,tt],st=["onClick"],ot=t("i",{class:"bi bi-x-lg"},null,-1),lt=[ot],at={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},nt={class:"modal-dialog modal-lg"},dt={class:"modal-content"},it=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},"訂單詳細資訊"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ct={class:"modal-body"},rt=t("h2",{class:"fs-6 bg-dark text-white mb-0 py-3 text-center"},"訂單內容",-1),ht={key:0,class:"table mb-10"},_t=t("thead",null,[t("tr",{class:"table-light"},[t("th",{scope:"col"},"訂單編號"),t("th",{scope:"col"},"下單日期"),t("th",{scope:"col"},"付款狀態"),t("th",{scope:"col"},"總金額")])],-1),pt={scope:"row"},ut={key:0,class:"fw-bold text-success"},mt={key:1,class:"text-secondary"},bt=t("h2",{class:"fs-6 bg-dark text-white mb-0 py-3 text-center"},"購買商品",-1),gt={key:1,class:"table mb-10 align-middle"},yt=t("thead",null,[t("tr",{class:"table-light"},[t("th",{scope:"col"},"品名"),t("th",{scope:"col"},"圖片"),t("th",{scope:"col"},"數量"),t("th",{scope:"col"},"金額")])],-1),ft={scope:"row"},kt=["src"],vt=t("h2",{class:"fs-6 bg-dark text-white mb-0 py-3 text-center"},"訂購人資訊",-1),wt={key:2,class:"table"},xt=t("thead",null,[t("tr",{class:"table-light"},[t("th",{scope:"col"},"姓名"),t("th",{scope:"col"},"Email"),t("th",{scope:"col"},"電話"),t("th",{scope:"col"},"地址")])],-1),It={scope:"row"},Ct={class:"form-check d-flex justify-content-end"},Pt=t("label",{for:"paid"},"已付款",-1),Lt={class:"modal-footer"},Mt=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1),Tt={class:"modal fade",id:"deleteModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Et={class:"modal-dialog modal-dialog-centered"},Vt={class:"modal-content"},Dt=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"刪除訂單"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Bt=t("div",{class:"modal-body"},[t("p",null,"是否確定刪除此訂單(刪除後將無法恢復)")],-1),St={class:"modal-footer"},Ut=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1),At={id:"toast",class:"toast hide toast-container position-fixed toast-placement",role:"alert","aria-live":"assertive","aria-atomic":"true"},Ot={class:"toast-header mb-0"},Rt={class:"me-auto"},Nt=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"toast","aria-label":"Close"},null,-1),jt={class:"toast-body"};function qt(d,l,c,p,s,r){const C=I("VueLoading"),P=I("pagination");return n(),a(_,null,[v(C,{active:s.isLoading},{default:E(()=>[S]),_:1},8,["active"]),t("div",U,[A,t("div",O,[t("table",R,[N,t("tbody",null,[(n(!0),a(_,null,m(s.orders,e=>(n(),a(_,{key:e.id},[s.orders.length?(n(),a("tr",j,[t("td",q,o(new Date(e.create_at*1e3).toLocaleDateString()),1),t("td",null,o(e.user.email),1),t("td",null,[(n(!0),a(_,null,m(e.products,i=>(n(),a("ul",z,[t("li",F,[t("img",{src:i.product.imageUrl,alt:"product.product.title",width:"50",class:"me-2 rounded"},null,8,H),t("div",G,[t("div",null,o(i.product.title),1),t("div",X,o(i.qty+i.product.unit),1)])])]))),128))]),t("td",null,o(e.total)+" 元",1),t("td",null,[t("div",J,[w(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":i=>e.is_paid=i,onChange:i=>r.updatePaid(e)},null,40,K),[[x,e.is_paid]]),t("label",Q,[e.is_paid?(n(),a("span",W,"已付款")):(n(),a("span",Y,"未付款"))])])]),t("td",null,[t("button",{type:"button",class:"btn btn-dark btn-sm",onClick:i=>r.openModal(e,"edit")},et,8,Z)]),t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:i=>r.openModal(e,"delete")},lt,8,st)])])):u("",!0)],64))),128))])])])]),v(P,{"total-Page":r.totalPage,"current-Page":s.currentPage,onSwichPage:d.switchPage,class:"my-15"},null,8,["total-Page","current-Page","onSwichPage"]),t("div",at,[t("div",nt,[t("div",dt,[it,t("div",ct,[rt,s.tempItem?(n(),a("table",ht,[_t,t("tbody",null,[t("tr",null,[t("th",pt,o(s.tempItem.id),1),t("td",null,o(new Date(s.tempItem.create_at*1e3).toLocaleDateString()),1),t("td",null,[s.tempItem.is_paid?(n(),a("span",ut,"已付款")):(n(),a("span",mt,"尚未付款"))]),t("td",null,o(s.tempItem.total),1)])])])):u("",!0),bt,s.tempItem?(n(),a("table",gt,[yt,t("tbody",null,[(n(!0),a(_,null,m(s.tempItem.products,e=>(n(),a("tr",{key:e.id},[t("td",ft,o(e.product.title),1),t("td",null,[t("img",{src:e.product.imageUrl,alt:"product.product.title",width:"100"},null,8,kt)]),t("td",null,o(e.qty),1),t("td",null,o(e.total),1)]))),128))])])):u("",!0),vt,s.tempItem.user?(n(),a("table",wt,[xt,t("tbody",null,[t("tr",null,[t("td",It,o(s.tempItem.user.name),1),t("td",null,o(s.tempItem.user.email),1),t("td",null,o(s.tempItem.user.tel),1),t("td",null,o(s.tempItem.user.address),1)])])])):u("",!0),t("div",Ct,[w(t("input",{type:"checkbox",class:"form-check-input me-3",id:"paid","onUpdate:modelValue":l[0]||(l[0]=e=>s.tempItem.is_paid=e)},null,512),[[x,s.tempItem.is_paid]]),Pt])]),t("div",Lt,[Mt,t("button",{type:"button",class:"btn btn-success",onClick:l[1]||(l[1]=e=>r.updatePaid(s.tempItem))},"儲存變更")])])])]),t("div",Tt,[t("div",Et,[t("div",Vt,[Dt,Bt,t("div",St,[Ut,t("button",{type:"button",class:"btn btn-danger",onClick:l[2]||(l[2]=(...e)=>r.deleteOrder&&r.deleteOrder(...e))},"確定")])])])]),t("div",At,[t("div",Ot,[t("strong",Rt,o(s.toastTitle),1),Nt]),t("div",jt,o(s.toastContent),1)])],64)}const Xt=T(B,[["render",qt]]);export{Xt as default};
